<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Prioritization & Risk Assessment Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .section-title {
            border-bottom: 2px solid #3b82f6; /* blue-500 */
            padding-bottom: 0.5rem;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #d1d5db; /* gray-300 */
            border-radius: 5px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6; /* blue-500 */
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3b82f6; /* blue-500 */
            cursor: pointer;
            border-radius: 50%;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">Interactive Prioritization Tool</h1>
            <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Input your tasks, score them using the framework, and generate a data-driven action plan.</p>
        </header>

        <!-- Main Content -->
        <main class="grid lg:grid-cols-5 gap-8">

            <!-- Left Column: Input Form -->
            <div class="lg:col-span-2">
                <div class="card p-6 sticky top-8">
                    <h2 class="text-2xl font-bold mb-4">Add a New Task</h2>
                    <form id="task-form" class="space-y-6">
                        <div>
                            <label for="task-description" class="block text-sm font-medium text-gray-700">Task Description</label>
                            <input type="text" id="task-description" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label for="task-severity" class="block text-sm font-medium text-gray-700">Severity: <span id="severity-value" class="font-bold text-blue-600">3</span></label>
                            <input type="range" id="task-severity" min="1" max="5" value="3" class="w-full">
                        </div>

                        <div>
                            <label for="task-risk" class="block text-sm font-medium text-gray-700">Risk of Not Fixing: <span id="risk-value" class="font-bold text-blue-600">3</span></label>
                            <input type="range" id="task-risk" min="1" max="5" value="3" class="w-full">
                        </div>

                        <div>
                            <label for="task-effort" class="block text-sm font-medium text-gray-700">Effort (Inverted): <span id="effort-value" class="font-bold text-blue-600">3</span></label>
                            <p class="text-xs text-gray-500">5 = Low Effort, 1 = High Effort</p>
                            <input type="range" id="task-effort" min="1" max="5" value="3" class="w-full">
                        </div>

                        <div>
                            <label for="task-dependencies" class="block text-sm font-medium text-gray-700">Dependencies (optional)</label>
                            <p class="text-xs text-gray-500">Enter task numbers, comma-separated (e.g., "1, 3")</p>
                            <input type="text" id="task-dependencies" placeholder="e.g., 1, 3" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition">Add Task</button>
                    </form>
                </div>
            </div>

            <!-- Right Column: Results -->
            <div class="lg:col-span-3 space-y-12">
                <!-- Task List Section -->
                <section id="task-list-section">
                    <h2 class="text-2xl font-bold mb-4 section-title">Task List</h2>
                    <div class="card overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full text-left">
                                <thead class="bg-gray-800 text-white">
                                    <tr>
                                        <th class="p-4 font-semibold">#</th>
                                        <th class="p-4 font-semibold">Task</th>
                                        <th class="p-4 font-semibold text-center">Score</th>
                                        <th class="p-4 font-semibold text-center">Deps.</th>
                                        <th class="p-4 font-semibold text-center">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="task-table-body" class="divide-y divide-gray-200">
                                    <tr id="no-tasks-row">
                                        <td colspan="5" class="p-8 text-center text-gray-500">No tasks added yet.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Action Plan Section -->
                <section id="action-plan-section">
                    <h2 class="text-2xl font-bold mb-4 section-title">Prioritized Action Plan</h2>
                    <div id="action-plan-container" class="space-y-6">
                        <div class="card p-8 text-center text-gray-500">
                            Your action plan will appear here once you add tasks.
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        // --- DOM Elements ---
        const taskForm = document.getElementById('task-form');
        const taskDescriptionInput = document.getElementById('task-description');
        const taskSeverityInput = document.getElementById('task-severity');
        const taskRiskInput = document.getElementById('task-risk');
        const taskEffortInput = document.getElementById('task-effort');
        const taskDependenciesInput = document.getElementById('task-dependencies');
        const taskTableBody = document.getElementById('task-table-body');
        const noTasksRow = document.getElementById('no-tasks-row');
        const actionPlanContainer = document.getElementById('action-plan-container');

        // --- Range Slider Value Displays ---
        const severityValue = document.getElementById('severity-value');
        const riskValue = document.getElementById('risk-value');
        const effortValue = document.getElementById('effort-value');

        taskSeverityInput.addEventListener('input', () => severityValue.textContent = taskSeverityInput.value);
        taskRiskInput.addEventListener('input', () => riskValue.textContent = taskRiskInput.value);
        taskEffortInput.addEventListener('input', () => effortValue.textContent = taskEffortInput.value);

        // --- Data Store ---
        let tasks = [];
        let taskIdCounter = 1;

        // --- Event Listeners ---
        taskForm.addEventListener('submit', handleAddTask);

        // --- Functions ---
        function handleAddTask(event) {
            event.preventDefault();

            // 1. Get values and parse them
            const description = taskDescriptionInput.value.trim();
            if (!description) return;
            
            const severity = parseInt(taskSeverityInput.value);
            const risk = parseInt(taskRiskInput.value);
            const effort = parseInt(taskEffortInput.value);
            const dependencies = taskDependenciesInput.value.split(',')
                .map(d => parseInt(d.trim()))
                .filter(d => !isNaN(d) && d > 0);

            // 2. Calculate score
            const score = (severity + risk) * effort;

            // 3. Create task object
            const newTask = {
                id: taskIdCounter++,
                description,
                severity,
                risk,
                effort,
                dependencies,
                score
            };

            // 4. Add to data store
            tasks.push(newTask);

            // 5. Re-render UI
            renderAll();
            
            // 6. Reset form
            taskForm.reset();
            severityValue.textContent = '3';
            riskValue.textContent = '3';
            effortValue.textContent = '3';
            taskDescriptionInput.focus();
        }

        function handleDeleteTask(taskId) {
            tasks = tasks.filter(task => task.id !== taskId);
            // Also remove this task from others' dependencies
            tasks.forEach(task => {
                task.dependencies = task.dependencies.filter(dep => dep !== taskId);
            });
            renderAll();
        }

        function renderAll() {
            renderTaskTable();
            generateAndRenderActionPlan();
        }

        function renderTaskTable() {
            taskTableBody.innerHTML = ''; // Clear existing table
            if (tasks.length === 0) {
                taskTableBody.appendChild(noTasksRow);
                return;
            }

            tasks.forEach(task => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="p-4 font-bold">${task.id}</td>
                    <td class="p-4">${task.description}</td>
                    <td class="p-4 text-center font-bold text-blue-600">${task.score}</td>
                    <td class="p-4 text-center">${task.dependencies.join(', ') || 'â€“'}</td>
                    <td class="p-4 text-center">
                        <button onclick="handleDeleteTask(${task.id})" class="text-red-500 hover:text-red-700 font-semibold">Delete</button>
                    </td>
                `;
                taskTableBody.appendChild(row);
            });
        }

        function generateAndRenderActionPlan() {
            actionPlanContainer.innerHTML = '';
            if (tasks.length === 0) {
                actionPlanContainer.innerHTML = '<div class="card p-8 text-center text-gray-500">Your action plan will appear here once you add tasks.</div>';
                return;
            }

            // Topological sort to handle dependencies and create phases
            let remainingTasks = [...tasks];
            const completedTaskIds = new Set();
            let phases = [];
            let phaseNumber = 1;

            while (remainingTasks.length > 0) {
                let currentPhaseTasks = [];
                
                remainingTasks.forEach(task => {
                    const allDependenciesMet = task.dependencies.every(depId => completedTaskIds.has(depId));
                    if (allDependenciesMet) {
                        currentPhaseTasks.push(task);
                    }
                });

                if (currentPhaseTasks.length === 0 && remainingTasks.length > 0) {
                    // Circular dependency detected
                    actionPlanContainer.innerHTML = '<div class="card p-6 bg-red-100 border border-red-300 text-red-800"><h3 class="font-bold">Error: Circular Dependency Detected</h3><p>Please review your task dependencies. One or more tasks depend on each other in a loop.</p></div>';
                    return;
                }

                // Sort tasks within the phase by score (descending)
                currentPhaseTasks.sort((a, b) => b.score - a.score);
                
                phases.push({ number: phaseNumber++, tasks: currentPhaseTasks });
                
                // Update completed tasks and remove from remaining list
                currentPhaseTasks.forEach(task => completedTaskIds.add(task.id));
                remainingTasks = remainingTasks.filter(task => !completedTaskIds.has(task.id));
            }

            // Render the generated phases
            phases.forEach(phase => {
                const phaseCard = document.createElement('div');
                phaseCard.className = 'card p-6 border-l-4 border-green-500';
                
                let taskItems = phase.tasks.map(task => 
                    `<li class="flex justify-between items-center py-1">
                        <span><strong>#${task.id}:</strong> ${task.description}</span>
                        <span class="font-bold text-blue-600 bg-blue-100 px-2 py-1 rounded-full text-sm">Score: ${task.score}</span>
                    </li>`
                ).join('');

                phaseCard.innerHTML = `
                    <h4 class="text-xl font-bold mb-2">Phase ${phase.number}</h4>
                    <ul class="list-disc list-inside text-gray-700 space-y-1 divide-y divide-gray-200">${taskItems}</ul>
                `;
                actionPlanContainer.appendChild(phaseCard);
            });
        }
    </script>
</body>
</html>
